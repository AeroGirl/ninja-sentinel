(function(){Function.prototype.scopedTo===void 0&&(Function.prototype.scopedTo=function(a,b){var c=this;return function(){return c.apply(a,Array.prototype.slice.call(b||[]).concat(Array.prototype.slice.call(arguments)))}});var a=function(b,d){this.options=d||{},this.key=b,this.channels=new a.Channels,this.global_emitter=new a.EventsDispatcher;var e=this;this.checkAppKey(),this.connection=new a.Connection(this.key,this.options),this.connection.bind("connected",function(){e.subscribeAll()}).bind("message",function(a){var b=a.event.indexOf("pusher_internal:")===0;if(a.channel){var c;(c=e.channel(a.channel))&&c.emit(a.event,a.data)}b||e.global_emitter.emit(a.event,a.data)}).bind("disconnected",function(){e.channels.disconnect()}).bind("error",function(b){a.warn("Error",b)}),a.instances.push(this),a.isReady&&e.connect()};a.instances=[],a.prototype={channel:function(a){return this.channels.find(a)},connect:function(){this.connection.connect()},disconnect:function(){this.connection.disconnect()},bind:function(a,b){return this.global_emitter.bind(a,b),this},bind_all:function(a){return this.global_emitter.bind_all(a),this},subscribeAll:function(){for(channelName in this.channels.channels)this.channels.channels.hasOwnProperty(channelName)&&this.subscribe(channelName)},subscribe:function(a){var b=this,c=this.channels.add(a,this);return this.connection.state==="connected"&&c.authorize(this.connection.socket_id,this.options,function(d,f){d?c.emit("pusher:subscription_error",f):b.send_event("pusher:subscribe",{channel:a,auth:f.auth,channel_data:f.channel_data})}),c},unsubscribe:function(a){this.channels.remove(a),this.connection.state==="connected"&&this.send_event("pusher:unsubscribe",{channel:a})},send_event:function(a,b,c){return this.connection.send_event(a,b,c)},checkAppKey:function(){(this.key===null||this.key===void 0)&&a.warn("Warning","You must pass your app key when you instantiate Pusher.")}},a.Util={extend:function b(a,c){for(var d in c)a[d]=c[d]&&c[d].constructor&&c[d].constructor===Object?b(a[d]||{},c[d]):c[d];return a},stringify:function(){for(var a=["Pusher"],b=0;b<arguments.length;b++)typeof arguments[b]=="string"?a.push(arguments[b]):window.JSON==void 0?a.push(arguments[b].toString()):a.push(JSON.stringify(arguments[b]));return a.join(" : ")},arrayIndexOf:function(a,b){var c=Array.prototype.indexOf;if(a==null)return-1;if(c&&a.indexOf===c)return a.indexOf(b);for(i=0,l=a.length;i<l;i++)if(a[i]===b)return i;return-1}},a.debug=function(){a.log&&a.log(a.Util.stringify.apply(this,arguments))},a.warn=function(){window.console&&window.console.warn?window.console.warn(a.Util.stringify.apply(this,arguments)):a.log&&a.log(a.Util.stringify.apply(this,arguments))},a.VERSION="1.12.5",a.host="ws.pusherapp.com",a.ws_port=80,a.wss_port=443,a.sockjs_host="sockjs.pusher.com",a.sockjs_http_port=80,a.sockjs_https_port=443,a.sockjs_path="/pusher",a.channel_auth_endpoint="/pusher/auth",a.cdn_http="http://js.pusher.com/",a.cdn_https="https://d3dy5gmtp8yhk7.cloudfront.net/",a.dependency_suffix=".min",a.channel_auth_transport="ajax",a.activity_timeout=12e4,a.pong_timeout=3e4,a.isReady=!1,a.ready=function(){a.isReady=!0;for(var b=0,d=a.instances.length;b<d;b++)a.instances[b].connect()},this.Pusher=a}).call(this),function(){function a(){this._callbacks={}}function b(b){this.callbacks=new a,this.global_callbacks=[],this.failThrough=b}a.prototype.get=function(a){return this._callbacks[this._prefix(a)]},a.prototype.add=function(a,b){var c=this._prefix(a);this._callbacks[c]=this._callbacks[c]||[],this._callbacks[c].push(b)},a.prototype.remove=function(a,b){if(this.get(a)){var c=Pusher.Util.arrayIndexOf(this.get(a),b);this._callbacks[this._prefix(a)].splice(c,1)}},a.prototype._prefix=function(a){return"_"+a},b.prototype.bind=function(a,b){return this.callbacks.add(a,b),this},b.prototype.unbind=function(a,b){return this.callbacks.remove(a,b),this},b.prototype.emit=function(a,b){for(var c=0;c<this.global_callbacks.length;c++)this.global_callbacks[c](a,b);var d=this.callbacks.get(a);if(d)for(c=0;c<d.length;c++)d[c](b);else this.failThrough&&this.failThrough(a,b);return this},b.prototype.bind_all=function(a){return this.global_callbacks.push(a),this},this.Pusher.EventsDispatcher=b}.call(this),function(){function a(a,b,c){b[a]!==void 0&&b[a](c)}function b(a,b,d){c.EventsDispatcher.call(this),this.state=void 0,this.errors=[],this.stateActions=d,this.transitions=b,this.transition(a)}var c=this.Pusher;b.prototype.transition=function(b,d){var e=this.state,f=this.stateActions;if(e&&c.Util.arrayIndexOf(this.transitions[e],b)==-1)throw this.emit("invalid_transition_attempt",{oldState:e,newState:b}),Error("Invalid transition ["+e+" to "+b+"]");a(e+"Exit",f,d),a(e+"To"+(b.substr(0,1).toUpperCase()+b.substr(1)),f,d),a(b+"Pre",f,d),this.state=b,this.emit("state_change",{oldState:e,newState:b}),a(b+"Post",f,d)},b.prototype.is=function(a){return this.state===a},b.prototype.isNot=function(a){return this.state!==a},c.Util.extend(b.prototype,c.EventsDispatcher.prototype),this.Pusher.Machine=b}.call(this),function(){var a=function(){var a=this;Pusher.EventsDispatcher.call(this),window.addEventListener!==void 0&&(window.addEventListener("online",function(){a.emit("online",null)},!1),window.addEventListener("offline",function(){a.emit("offline",null)},!1))};a.prototype.isOnLine=function(){return window.navigator.onLine===void 0?!0:window.navigator.onLine},Pusher.Util.extend(a.prototype,Pusher.EventsDispatcher.prototype),this.Pusher.NetInfo=a}.call(this),function(){function a(a){a.connectionWait=0,a.openTimeout=c.TransportType==="native"?4e3:c.TransportType==="flash"?7e3:6e3,a.connectedTimeout=2e3,a.connectionSecure=a.compulsorySecure,a.failedAttempts=0}function b(b,i){function k(){x.openTimeout<g&&(x.openTimeout+=e),x.connectedTimeout<h&&(x.connectedTimeout+=f),x.compulsorySecure!==!0&&(x.connectionSecure=!x.connectionSecure),x.failedAttempts++}function l(a){return a=a||document.location.protocol==="https:",(a?"wss://":"ws://")+c.host+":"+(a?c.wss_port:c.ws_port)}function m(a){return a=a||document.location.protocol==="https:",(a?"https://":"http://")+c.sockjs_host+":"+(a?c.sockjs_https_port:c.sockjs_http_port)+c.sockjs_path}function n(){x._machine.transition("impermanentlyClosing")}function o(){x._activityTimer&&clearTimeout(x._activityTimer),x.ping&&(x._activityTimer=setTimeout(function(){x.send_event("pusher:ping",{}),x._activityTimer=setTimeout(function(){x.socket.close()},x.options.pong_timeout||c.pong_timeout)},x.options.activity_timeout||c.activity_timeout))}function p(){var a=x.connectionWait;if(a===0&&x.connectedAt){var b=(new Date).getTime()-x.connectedAt;b<1e3&&(a=1e3-b)}return a}function q(a){a=s(a);if(a!==void 0)if(a.event==="pusher:connection_established")x._machine.transition("connected",a.data.socket_id);else if(a.event==="pusher:error"){var b=a.data.code;x.emit("error",{type:"PusherError",data:{code:b,message:a.data.message}}),b===4e3?(x.compulsorySecure=!0,x.connectionSecure=!0,x.options.encrypted=!0,n()):b<4100?x._machine.transition("permanentlyClosing"):b<4200?(x.connectionWait=1e3,x._machine.transition("waiting")):b<4300?n():x._machine.transition("permanentlyClosing")}}function r(a){o(),a=s(a);if(a!==void 0){c.debug("Event recd",a);switch(a.event){case"pusher:error":x.emit("error",{type:"PusherError",data:a.data});break;case"pusher:ping":x.send_event("pusher:pong",{})}x.emit("message",a)}}function s(a){try{var b=JSON.parse(a.data);if(typeof b.data=="string")try{b.data=JSON.parse(b.data)}catch(c){if(!(c instanceof SyntaxError))throw c}return b}catch(d){x.emit("error",{type:"MessageParseError",error:d,data:a.data})}}function u(){x._machine.transition("waiting")}function v(a){x.emit("error",{type:"WebSocketError",error:a})}function w(a,b){var d=x.state;x.state=a,d!==a&&(c.debug("State changed",d+" -> "+a),x.emit("state_change",{previous:d,current:a}),x.emit(a,b))}var x=this;c.EventsDispatcher.call(this),this.ping=!0,this.options=c.Util.extend({encrypted:!1},i),this.netInfo=new c.NetInfo,this.netInfo.bind("online",function(){x._machine.is("waiting")&&(x._machine.transition("connecting"),w("connecting"))}),this.netInfo.bind("offline",function(){x._machine.is("connected")&&(x.socket.onclose=void 0,x.socket.onmessage=void 0,x.socket.onerror=void 0,x.socket.onopen=void 0,x.socket.close(),x.socket=void 0,x._machine.transition("waiting"))}),this._machine=new c.Machine("initialized",d,{initializedPre:function(){x.compulsorySecure=x.options.encrypted,x.key=b,x.socket=null,x.socket_id=null,x.state="initialized"},waitingPre:function(){x.netInfo.isOnLine()?(x.failedAttempts<2?w("connecting"):(w("unavailable"),x.connectionWait=1e4),x.connectionWait>0&&x.emit("connecting_in",p()),x._waitingTimer=setTimeout(function(){x._machine.transition("connecting")},p())):w("unavailable")},waitingExit:function(){clearTimeout(x._waitingTimer)},connectingPre:function(){if(x.netInfo.isOnLine()===!1)x._machine.transition("waiting"),w("unavailable");else{var a="/app/"+x.key+"?protocol=5&client=js&version="+c.VERSION+"&flash="+(c.TransportType==="flash"?"true":"false");if(c.TransportType==="sockjs"){c.debug("Connecting to sockjs",c.sockjs);var b=m(x.connectionSecure);x.ping=!1,x.socket=new SockJS(b),x.socket.onopen=function(){x.socket.send(JSON.stringify({path:a})),x._machine.transition("open")}}else b=l(x.connectionSecure)+a,c.debug("Connecting",b),x.socket=new c.Transport(b),x.socket.onopen=function(){x._machine.transition("open")};x.socket.onclose=u,x.socket.onerror=v,x._connectingTimer=setTimeout(n,x.openTimeout)}},connectingExit:function(){clearTimeout(x._connectingTimer),x.socket.onopen=void 0},connectingToWaiting:function(){k()},connectingToImpermanentlyClosing:function(){k()},openPre:function(){x.socket.onmessage=q,x.socket.onerror=v,x.socket.onclose=u,x._openTimer=setTimeout(n,x.connectedTimeout)},openExit:function(){clearTimeout(x._openTimer),x.socket.onmessage=void 0},openToWaiting:function(){k()},openToImpermanentlyClosing:function(){k()},connectedPre:function(b){x.socket_id=b,x.socket.onmessage=r,x.socket.onerror=v,x.socket.onclose=u,a(x),x.connectedAt=(new Date).getTime(),o()},connectedPost:function(){w("connected")},connectedExit:function(){x._activityTimer&&clearTimeout(x._activityTimer),w("disconnected")},impermanentlyClosingPost:function(){x.socket&&(x.socket.onclose=u,x.socket.close())},permanentlyClosingPost:function(){x.socket?(x.socket.onclose=function(){a(x),x._machine.transition("permanentlyClosed")},x.socket.close()):(a(x),x._machine.transition("permanentlyClosed"))},failedPre:function(){w("failed"),c.debug("WebSockets are not available in this browser.")},permanentlyClosedPost:function(){w("disconnected")}})}var c=this.Pusher,d={initialized:["waiting","failed"],waiting:["connecting","permanentlyClosed"],connecting:["open","permanentlyClosing","impermanentlyClosing","waiting"],open:["connected","permanentlyClosing","impermanentlyClosing","waiting"],connected:["permanentlyClosing","waiting"],impermanentlyClosing:["waiting","permanentlyClosing"],permanentlyClosing:["permanentlyClosed"],permanentlyClosed:["waiting","failed"],failed:["permanentlyClosed"]},e=2e3,f=2e3,g=1e4,h=1e4;b.prototype.connect=function(){!this._machine.is("failed")&&!c.Transport?this._machine.transition("failed"):this._machine.is("initialized")?(a(this),this._machine.transition("waiting")):this._machine.is("waiting")&&this.netInfo.isOnLine()===!0?this._machine.transition("connecting"):this._machine.is("permanentlyClosed")&&(a(this),this._machine.transition("waiting"))},b.prototype.send=function(a){if(this._machine.is("connected")){var b=this;return setTimeout(function(){b.socket.send(a)},0),!0}return!1},b.prototype.send_event=function(a,b,d){return a={event:a,data:b},d&&(a.channel=d),c.debug("Event sent",a),this.send(JSON.stringify(a))},b.prototype.disconnect=function(){this._machine.is("permanentlyClosed")||(this._machine.is("waiting")||this._machine.is("failed")?this._machine.transition("permanentlyClosed"):this._machine.transition("permanentlyClosing"))},c.Util.extend(b.prototype,c.EventsDispatcher.prototype),this.Pusher.Connection=b}.call(this),function(){Pusher.Channels=function(){this.channels={}},Pusher.Channels.prototype={add:function(a,b){var c=this.find(a);return c||(c=Pusher.Channel.factory(a,b),this.channels[a]=c),c},find:function(a){return this.channels[a]},remove:function(a){delete this.channels[a]},disconnect:function(){for(var a in this.channels)this.channels[a].disconnect()}},Pusher.Channel=function(a,b){var c=this;Pusher.EventsDispatcher.call(this,function(b){Pusher.debug("No callbacks on "+a+" for "+b)}),this.pusher=b,this.name=a,this.subscribed=!1,this.bind("pusher_internal:subscription_succeeded",function(a){c.onSubscriptionSucceeded(a)})},Pusher.Channel.prototype={init:function(){},disconnect:function(){this.subscribed=!1,this.emit("pusher_internal:disconnected")},onSubscriptionSucceeded:function(){this.subscribed=!0,this.emit("pusher:subscription_succeeded")},authorize:function(a,b,c){return c(!1,{})},trigger:function(a,b){return this.pusher.send_event(a,b,this.name)}},Pusher.Util.extend(Pusher.Channel.prototype,Pusher.EventsDispatcher.prototype),Pusher.Channel.PrivateChannel={authorize:function(a,b,c){var d=this;return(new Pusher.Channel.Authorizer(this,Pusher.channel_auth_transport,b)).authorize(a,function(a,b){a||d.emit("pusher_internal:authorized",b),c(a,b)})}},Pusher.Channel.PresenceChannel={init:function(){this.members=new a(this)},onSubscriptionSucceeded:function(){this.subscribed=!0}};var a=function(a){var b=this,c=function(){this._members_map={},this.count=0,this.me=null};c.call(this),a.bind("pusher_internal:authorized",function(c){var d=JSON.parse(c.channel_data);a.bind("pusher_internal:subscription_succeeded",function(c){b._members_map=c.presence.hash,b.count=c.presence.count,b.me=b.get(d.user_id),a.emit("pusher:subscription_succeeded",b)})}),a.bind("pusher_internal:member_added",function(c){b.get(c.user_id)===null&&b.count++,b._members_map[c.user_id]=c.user_info,a.emit("pusher:member_added",b.get(c.user_id))}),a.bind("pusher_internal:member_removed",function(c){var d=b.get(c.user_id);d&&(delete b._members_map[c.user_id],b.count--,a.emit("pusher:member_removed",d))}),a.bind("pusher_internal:disconnected",function(){c.call(b)})};a.prototype={each:function(a){for(var b in this._members_map)a(this.get(b))},get:function(a){return this._members_map.hasOwnProperty(a)?{id:a,info:this._members_map[a]}:null}},Pusher.Channel.factory=function(a,b){var c=new Pusher.Channel(a,b);return a.indexOf("private-")===0?Pusher.Util.extend(c,Pusher.Channel.PrivateChannel):a.indexOf("presence-")===0&&(Pusher.Util.extend(c,Pusher.Channel.PrivateChannel),Pusher.Util.extend(c,Pusher.Channel.PresenceChannel)),c.init(),c}}.call(this),function(){Pusher.Channel.Authorizer=function(a,b,c){this.channel=a,this.type=b,this.authOptions=(c||{}).auth||{}},Pusher.Channel.Authorizer.prototype={composeQuery:function(a){var a="&socket_id="+encodeURIComponent(a)+"&channel_name="+encodeURIComponent(this.channel.name),b;for(b in this.authOptions.params)a+="&"+encodeURIComponent(b)+"="+encodeURIComponent(this.authOptions.params[b]);return a},authorize:function(a,b){return Pusher.authorizers[this.type].call(this,a,b)}},Pusher.auth_callbacks={},Pusher.authorizers={ajax:function(a,b){var c;c=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),c.open("POST",Pusher.channel_auth_endpoint,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var d in this.authOptions.headers)c.setRequestHeader(d,this.authOptions.headers[d]);return c.onreadystatechange=function(){if(c.readyState==4)if(c.status==200){var a,d=!1;try{a=JSON.parse(c.responseText),d=!0}catch(e){b(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+c.responseText)}d&&b(!1,a)}else Pusher.warn("Couldn't get auth info from your webapp",c.status),b(!0,c.status)},c.send(this.composeQuery(a)),c},jsonp:function(a,b){this.authOptions.headers!==void 0&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var c=document.createElement("script");Pusher.auth_callbacks[this.channel.name]=function(a){b(!1,a)},c.src=Pusher.channel_auth_endpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+this.channel.name+"']")+this.composeQuery(a);var d=document.getElementsByTagName("head")[0]||document.documentElement;d.insertBefore(c,d.firstChild)}}}.call(this);var _require=function(){function a(a,b){document.addEventListener?a.addEventListener("load",b,!1):a.attachEvent("onreadystatechange",function(){(a.readyState=="loaded"||a.readyState=="complete")&&b()})}function b(b,d){var e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.setAttribute("src",b),f.setAttribute("type","text/javascript"),f.setAttribute("async",!0),a(f,function(){d()}),e.appendChild(f)}return function(a,c){for(var d=0,e=0;e<a.length;e++)b(a[e],function(){a.length==++d&&setTimeout(c,0)})}}();(function(){!window.WebSocket&&window.MozWebSocket&&(window.WebSocket=window.MozWebSocket),window.WebSocket&&(Pusher.Transport=window.WebSocket,Pusher.TransportType="native");var a=(document.location.protocol=="http:"?Pusher.cdn_http:Pusher.cdn_https)+Pusher.VERSION,b=[];window.JSON||b.push(a+"/json2"+Pusher.dependency_suffix+".js"),window.WebSocket||(window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0,b.push(a+"/flashfallback"+Pusher.dependency_suffix+".js"));var c=function(){return window.WebSocket?function(){Pusher.ready()}:function(){window.WebSocket?(Pusher.Transport=window.WebSocket,Pusher.TransportType="flash",window.WEB_SOCKET_SWF_LOCATION=a+"/WebSocketMain.swf",WebSocket.__addTask(function(){Pusher.ready()}),WebSocket.__initialize()):(sockjsPath=a+"/sockjs"+Pusher.dependency_suffix+".js",_require([sockjsPath],function(){Pusher.Transport=SockJS,Pusher.TransportType="sockjs",Pusher.ready()}))}}(),d=function(a){var b=function(){document.body?a():setTimeout(b,0)};b()},e=function(){d(c)};b.length>0?_require(b,e):e()})(),"use strict";var DEBUG=!0,yeomanApp=angular.module("yeomanApp",["ngResource"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/editZone",{templateUrl:"views/editZone.html",controller:"EditZoneCtrl"}).when("/configureTrigger",{templateUrl:"views/configureTrigger.html",controller:"ConfigureTriggerCtrl"}).when("/alerts",{templateUrl:"views/alerts.html",controller:"AlertsCtrl"}).when("/configureAlert",{templateUrl:"views/configureAlert.html",controller:"ConfigureAlertCtrl"}).when("/history",{templateUrl:"views/history.html",controller:"HistoryCtrl"}).otherwise({redirectTo:"/"})}]).config(["$locationProvider",function(a){a.html5Mode(!1)}]);yeomanApp.run(["$rootScope","$location","UIEvents","NinjaService","UserService","PusherService","DeviceService","ZoneService","AlertService",function(a,b,c,d,e,f,g,h,i){a.setRoute=function(a){b.path(a)},e.GetLoginStatus(),e.GetInfo(),h.GetZones(),i.GetAlerts(),g.LoadUserDevices(function(){})}]),"use strict",yeomanApp.controller("MainCtrl",["$scope","$rootScope","UIEvents","ZoneFactory","ZoneService","EditZoneService",function(a,b,c,d,e,f){a.ConfigureMode=!1,a.Zones=e.Zones,a.AddZone=function(){var e=new d({});f.Zone=e,b.$broadcast(c.ZoneAdding,e),a.setRoute("/editZone")},a.$on(c.SetConfigureMode,function(b,c){a.ConfigureMode=c}),b.$broadcast(c.SetConfigureMode,a.ConfigureMode)}]),"use strict",yeomanApp.controller("HeaderCtrl",["$scope","$rootScope","$location","UIEvents","ZoneFactory","EditZoneService",function(a,b,c,d,e,f){a.ConfigureMode=!1,a.LocationIsHome=function(){return c.$$path==="/"},a.SetConfigureMode=function(c){a.ConfigureMode=c,b.$broadcast(d.SetConfigureMode,a.ConfigureMode),b.$broadcast(d.TopBarClose),c||b.setRoute("/")},b.$on(d.SetConfigureMode,function(b,c){a.ConfigureMode=c}),a.ConfigureAlerts=function(){b.$broadcast(d.TopBarClose),a.setRoute("/alerts")},a.GoHome=function(){b.$broadcast(d.TopBarClose),b.setRoute("/")},a.GoHistory=function(){b.$broadcast(d.TopBarClose),b.setRoute("/history")},a.AddZone=function(){var a=new e({});f.Zone=a,b.$broadcast(d.ZoneAdding,a),b.$broadcast(d.TopBarClose),b.setRoute("/editZone")}}]),"use strict",yeomanApp.controller("ZoneCtrl",["$scope","$rootScope","UIEvents","EditZoneService",function(a,b,c,d){a.EditZone=function(){b.$broadcast(c.ZoneEditing,a.zone),d.Zone=a.zone,a.setRoute("/editZone")},a.SetOverride=function(b){a.zone.SetOverride(b)},a.Delete=function(){a.zone.Delete()}}]),"use strict",yeomanApp.controller("EditZoneCtrl",["$scope","$rootScope","UIEvents","ZoneFactory","ZoneService","EditZoneService","EditTriggerService","TriggerFactory",function(a,b,c,d,e,f,g,h){a.Zone=f.Zone,a.Save=function(){a.Zone.Save()},a.Delete=function(){a.Zone.Delete(),a.setRoute("/")},a.AddNewTrigger=function(){var b=new h({zone:a.Zone});g.Trigger=b,a.setRoute("/configureTrigger")},a.EditTrigger=function(b){g.Trigger=b,a.setRoute("/configureTrigger")}}]),"use strict",yeomanApp.factory("ZoneFactory",["$rootScope","$http","UIEvents","NinjaUtilities","TriggerFactory",function(a,b,c,d,e){return function(f){this.id=null,this.Triggers=[],this.Options={name:"",triggers:{},overrideActive:null},this.Options=d.ObjectMerge(this.Options,f);var g=function(){this.Options.id&&(this.id=this.Options.id,delete this.Options.id);if(this.Options.triggers){var a=d.ObjectArrayToArray(this.Options.triggers,"data");for(var b=0;b<a.length;b++){var c=a[b];c.zone=this;var f=new e(c);this.Triggers.push(f)}delete this.Options.triggers}}.bind(this);return g(),this.Save=function(d){console.log("Zone.Save()"),this.id?b.put("/zone/"+this.id,this.Options,{headers:{"Content-Type":"application/json",Accept:"application/json"}}).success(function(b){DEBUG&&console.log("SaveZone Existing:",b),a.$broadcast(c.ZoneUpdated,this),d&&d(b)}):b.post("/zone",this.Options,{headers:{"Content-Type":"application/json",Accept:"application/json"}}).success(function(b){DEBUG&&console.log("SaveZone New:",b),this.id=b.id,a.$broadcast(c.ZoneAdded,this),d&&d(b)}.bind(this))},this.Delete=function(d){this.id&&b.delete("/zone/"+this.id).success(function(b){DEBUG&&console.log("DeleteZone:",b,this),a.$broadcast(c.ZoneRemoved,this),d&&d(b)}.bind(this))},this.Refresh=function(a){this.id&&b.get("/zone/"+this.id).success(function(b){DEBUG&&console.log("GetZone:",b),a&&a(b)})},this.HasTrigger=function(a){var b=!1;for(var c=0;c<this.Triggers.length;c++){var d=this.Triggers[c];if(d.Options.data===a.Options.data){b=!0;break}}return b},this.SetOverride=function(a){var c={overrideActive:a};b.put("/zone/"+this.id,c).success(function(b){this.Options.overrideActive=a,console.log("Zone.SetOverride",a)}.bind(this))},a.$on(c.TriggerRemoved,function(b,c){if(this.id===c.Zone.id){console.log("TriggerRemoved:",c);var d=this.Triggers.indexOf(c);console.log("Removing Trigger ",d),this.Triggers.splice(d,1),a.$watch()}}.bind(this)),a.$on(c.TriggerAdded,function(b,c){this.id===c.Zone.id&&(console.log("TriggerAdded:",c),this.HasTrigger(c)||(this.Triggers.push(c),a.$watch()))}.bind(this)),this}}]),"use strict",yeomanApp.factory("TriggerFactory",["$rootScope","$http","UIEvents","NinjaUtilities",function(a,b,c,d){return function(e){this.Zone=null,this.Options={name:"",data:"",type:""},this.Options=d.ObjectMerge(this.Options,e);var f=function(){this.Options.id&&(this.id=this.Options.id,delete this.Options.id),this.Options.zone&&(this.Zone=this.Options.zone,delete this.Options.zone),this.Options.Zone&&(this.Zone=this.Options.Zone,delete this.Options.Zone)}.bind(this);f(),this.IsValid=function(){var a=!0;return this.Options.type||(a=!1),this.Options.name||(a=!1),this.Options.data||(a=!1),this.Zone.id||(a=!1),a},this.Save=function(d){console.log("Trigger.Save()",this);if(this.IsValid()){var e=this.Options;return b.put("/zone/"+this.Zone.id+"/trigger",e).success(function(b){console.log(b),a.$broadcast(c.TriggerAdded,this),d&&d(b)}.bind(this)).error(function(a){console.log("Error:",a),d&&d(a)}),!0}return console.log("Trigger not valid for saving"),!1},this.Delete=function(d){console.log("Trigger.Delete()",this);var e=this;b.delete("/zone/"+this.Zone.id+"/trigger/"+this.Options.data).success(function(b){a.$broadcast(c.TriggerRemoved,e),d&&d(b)}).error(function(a){console.log("Error:",a),d&&d(a)})}}}]),"use strict",yeomanApp.factory("AlertFactory",["$rootScope","$http","UIEvents","NinjaUtilities",function(a,b,c,d){return function(e){this.id=null,this.Options={type:"",alertee:"",active:!1},this.Options=d.ObjectMerge(this.Options,e);var f=function(){this.Options.id&&(this.id=this.Options.id,delete this.Options.id);if(this.Options.triggers){var a=d.ObjectArrayToArray(this.Options.triggers,"data");for(var b=0;b<a.length;b++){var c=a[b];c.zone=this;var e=new TriggerFactory(c);this.Triggers.push(e)}delete this.Options.triggers}}.bind(this);f(),this.Save=function(d){DEBUG&&console.log("Alert.Save()"),this.id?b.put("/alert/"+this.id,this.Options).success(function(b){DEBUG&&console.log("AlertFactory.Put",b),a.$broadcast(c.AlertUpdated,this),d&&d(b)}.bind(this)):b.post("/alert",this.Options).success(function(b){b.id&&b.id.length>30&&(this.id=b.id,DEBUG&&console.log("AlertFactory.Post",b),a.$broadcast(c.AlertAdded,this),d&&d(b))}.bind(this))},this.Delete=function(){b.delete("/alert/"+this.id).success(function(b){DEBUG&&console.log("Alert.Delete()",b),a.$broadcast(c.AlertRemoved,this)}.bind(this))},this.Activate=function(d){var e={active:!0};b.put("/alert/"+this.id,e).success(function(b){DEBUG&&console.log("Alert.Activate",b),a.$broadcast(c.AlertActivated),this.Options.active=!0,d&&d(b)}.bind(this))},this.Deactivate=function(d){var e={active:!1};b.put("/alert/"+this.id,e).success(function(b){DEBUG&&console.log("Alert.Activate",b),a.$broadcast(c.AlertActivated),this.Options.active=!1,d&&d(b)}.bind(this))}}}]),"use strict",yeomanApp.service("Config",["$rootScope","$location",function(a,b){var c={YEOMAN:"Yeoman",LOCALHOST:"Localhost",DERP:"Derp",STAGING:"Staging",PRODUCTION:"Production"},d={Mode:c.YEOMAN,Server:"http://localhost:8000",StreamServer:"http://localhost:8000"},e={Mode:c.LOCALHOST,Server:"",StreamServer:""},f={Mode:c.DERP,Server:"",StreamServer:""},g={Mode:c.STAGING,Server:"",StreamServer:""},h={Mode:c.PRODUCTION,Server:"",StreamServer:""},i=function(){var a;switch(b.$$host){case"localhost":b.$$port===3501?a=c.YEOMAN:b.$$port===8e3&&(a=c.LOCALHOST);break;case"derp.local":a=c.DERP;break;case"staging.ninja.is":a=c.STAGING;break;default:a=c.PRODUCTION}return a};switch(i()){case c.YEOMAN:return d;case c.LOCALHOST:return e;case c.DERP:return f;case c.STAGING:return g;case c.PRODUCTION:return h}}]),"use strict",yeomanApp.service("NinjaService",["Config",function(a){var b={server:a.Server,streamServer:a.StreamServer,debug:!1};a.UserAccessToken&&a.UserAccessToken.length>0&&(b.userAccessToken=a.UserAccessToken);var c=new Ninja(b);return c}]),"use strict",yeomanApp.service("DeviceService",["$rootScope","$timeout","UIEvents","NinjaService","NinjaUtilities",function(a,b,c,d,e){var f={Devices:[],Blocks:[],LoadUserDevices:function(a){DEBUG&&console.log("LoadUserDevices"),d.User.GetDevices(this.SetUserDevices.bind(this)),a&&d.User.GetDevices(a)},FilterUserDevices:function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c],e,f;if(parseInt(d.Options.deviceId)===30){e=this.GetDeviceByDeviceId(30,b),f=!1;for(var g=0;g<e.length;g++){var h=e[g];h.Options.port===d.Options.port&&(f=!0)}f||b.push(d)}else if(parseInt(d.Options.deviceId)===31){e=this.GetDeviceByDeviceId(31,b),f=!1;for(var g=0;g<e.length;g++){var h=e[g];h.Options.port===d.Options.port&&(f=!0)}f||b.push(d)}else b.push(d)}return b},SetUserDevices:function(b){this.Devices=this.FilterUserDevices(b.devices),this.Blocks=b.blocks,a.$broadcast(c.DevicesLoaded,this.Devices)},CreateAddDevice:function(b){var f=e.SplitGUID(b.GUID),g=this.GetCreateBlockByNodeId(f.nodeId),h=new d.Device({deviceId:f.deviceId,name:"New Device (TODO: Lookup)",vendor:b.V,port:b.G,value:b.DA,pusherData:b});g.RegisterDevice(h);var i=function(a){h.Options.rawData=a,h.Options.type=a.device_type,h.Options.name=a.default_name,h.Options.rawData.shortName=a.default_name};h.GetData(i.bind(this));var j=this.Devices.slice();j.push(h),j=this.FilterUserDevices(j),j.length!==this.Devices.length&&this.Devices.push(h),a.$apply(),a.$broadcast(c.IsotopeReLayout)},GetCreateBlockByNodeId:function(a){var b;if(this.Blocks)for(var c=0;c<this.Blocks.length;c++){var e=this.Blocks[c];e.Options.nodeId===a&&(b=e)}return b===undefined&&(b=new d.Block({nodeId:a}),this.Blocks.push(b)),b},GetDeviceByNodeId:function(a,b){var c=[];b||(b=this.Devices);if(b)for(var d=0;d<b.length;d++){var e=b[d];e.Options.block.Options.nodeId===a&&c.push(e)}return c},GetDeviceByGuid:function(a,b){b||(b=this.Devices);if(b)for(var c=0;c<b.length;c++){var d=b[c];if(d.GUID()===a)return d}return null},GetDeviceByType:function(a,b){var c=[];b||(b=this.Devices);if(b)for(var d=0;d<b.length;d++){var e=b[d];e.Options.type===a&&c.push(e)}return c},GetDeviceByMode:function(a,b){var c=[];b||(b=this.Devices);if(b)for(var d=0;d<b.length;d++){var e=b[d];e.Options.mode===a&&c.push(e)}return c},GetDeviceByDeviceId:function(a,b){var c=[];b||(b=this.Devices);if(b)for(var d=0;d<b.length;d++){var e=b[d];parseInt(e.Options.deviceId)===parseInt(a)&&c.push(e)}return c},GetWebService:function(a,b){var c,e=this,f=this.GetDeviceByType(a);return f.length===0?d.User.CreateService(a,function(a,c){e.Devices.push(a),e.Blocks.push(c),b&&b(a)}):(c=f[0],b&&b(c)),c}};return a.$on(c.PusherData,function(a,b){var c=f.GetDeviceByGuid(b.GUID);c||f.CreateAddDevice(b)}),a.$on(c.DeviceRemoved,function(b,d){var e=f.GetDeviceByGuid(d.GUID()),g=f.Devices.indexOf(e);f.Devices.splice(g,1),a.$emit(c.IsotopeReLayout,d)}),f}]),"use strict",yeomanApp.service("NinjaUtilities",function(){return Ninja.Utilities}),"use strict",yeomanApp.service("PusherService",["$rootScope","UIEvents","NinjaService","UserService",function(a,b,c,d){var e,f;a.$on(b.UserInfoLoaded,function(c,d){if(d.error)return;var g=d.pusherKey;e=new Pusher(g),f=e.subscribe(d.pusherChannel),e.log=function(a){console.log(a)};var h=function(c){a.$broadcast(b.PusherHeartbeat,c)},i=function(c){a.$broadcast(b.PusherData,c)},j=function(c){a.$broadcast(b.PusherStream,c)},k=function(c){switch(c.type){case"NODE_ACTIVATION":break;case"PLUGIN":a.$broadcast(b.DevicePlugin,c);break;case"UNPLUG":a.$broadcast(b.DeviceUnplug,c);break;default:a.$broadcast(b.PusherConfig,c)}};f.bind("heartbeat",h),f.bind("data",i),f.bind("stream",j),f.bind("config",k)})}]),"use strict",yeomanApp.service("UIEvents",function(){var a={PusherData:"PusherData",PusherHeartbeat:"PusherHeartbeat",PusherConfig:"PusherConfig",PusherStream:"PusherStream",ConfigureMode:"ConfigureMode",UserIsLoggedIn:"UserIsLoggedIn",UserIsLoggedOut:"UserIsLoggedOut",UserStatusChecked:"UserStatusChecked",UserLoggingIn:"UserLoggingIn",UserLogin:"UserLogin",UserLoginFailed:"UserLoginFailed",UserLoggingOut:"UserLoggingOut",UserLogout:"UserLogout",UserLogoutFailed:"UserLogoutFailed",UserInfoLoading:"UserInfoLoading",UserInfoLoaded:"UserInfoLoaded",UserInfoLoadFailed:"UserInfoLoadFailed",TopBarOpen:"TopBarOpen",TopBarClose:"TopBarClose",DevicePlugin:"DevicePlugin",DeviceUnplug:"DeviceUnplug",DevicesLoading:"DevicesLoading",DevicesLoaded:"DevicesLoaded",DevicesLoadFailed:"DevicesLoadFailed",DeviceRemoving:"DeviceRemoving",DeviceRemoved:"DeviceRemoved",DeviceRemoveFailed:"DeviceRemoveFailed",SetDeviceType:"SetDeviceType",ServiceUpdated:"ServiceUpdated",ZoneAdding:"ZoneAdding",ZoneAdded:"ZoneAdded",ZoneAddFailed:"ZoneAddFailed",ZoneEditing:"ZoneEditing",ZoneEdited:"ZoneEdited",ZoneEditFailed:"ZoneEditFailed",ZoneUpdating:"ZoneUpdating",ZoneUpdated:"ZoneUpdated",ZoneUpdateFailed:"ZoneUpdateFailed",ZoneSaving:"ZoneSaving",ZoneSaved:"ZoneSaved",ZoneSaveFailed:"ZoneSaveFailed",ZoneRemoving:"ZoneRemoving",ZoneRemoved:"ZoneRemoved",ZoneRemoveFailed:"ZoneRemoveFailed",TriggerAdding:"TriggerAdding",TriggerAdded:"TriggerAdded",TriggerAddFailed:"TriggerAddFailed",TriggerRemoving:"TriggerRemoving",TriggerRemoved:"TriggerRemoved",TriggerRemoveFailed:"TriggerRemoveFailed",OverrideUpdate:"OverrideUpdate",AlertAdding:"AlertAdding",AlertAdded:"AlertAdded",AlertAddFailed:"AlertAddFailed",AlertUpdating:"AlertUpdating",AlertUpdated:"AlertUpdated",AlertUpdateFailed:"AlertUpdateFailed",AlertRemoving:"AlertRemoving",AlertRemoved:"AlertRemoved",AlertRemoveFailed:"AlertRemoveFailed",AlertActivated:"AlertActivated",AlertDeactivated:"AlertDeactivated"};return a}),"use strict",yeomanApp.factory("UserService",["$rootScope","$q","$http","Config","UIEvents","NinjaService",function(a,b,c,d,e,f){var g={InfoDeferred:b.defer(),GetInfo:function(){f.User.GetInfo(this.GetInfo_Handler.bind(this))},GetInfo_Handler:function(b){this.Info=b,a.$broadcast(e.UserInfoLoaded,b),this.InfoDeferred.resolve(b)},Info:{},GetLoginStatus:function(){f.User.GetInfo(this.GetLoginStatus_Handler.bind(this))},GetLoginStatus_Handler:function(b){b.error?(this.IsLoggedIn=!1,a.$broadcast(e.UserStatusChecked,this.IsLoggedIn)):(this.IsLoggedIn=!0,a.$broadcast(e.UserStatusChecked,this.IsLoggedIn))},IsLoggedIn:!1,Login:function(b,f){var g={email:b,password:f,rememberme:!1,redirect:"/alpha/"};c.post(d.Server+"/signin",g).success(function(b){b.result===1&&(DEBUG&&console.log("Login()",this),a.$broadcast(e.UserLogin),this.IsLoggedIn=!0)}.bind(this)).error(function(b){a.$broadcast(e.UserLoginFailed,b),this.IsLoggedIn=!1}.bind(this))},Logout:function(){c.get(d.Server+"/signout").success(function(b){a.$broadcast(e.UserLogout),DEBUG&&console.log("Logout():",this),this.IsLoggedIn=!1}.bind(this)).error(function(b){a.$broadcast(e.UserLogoutFailed)})}};return g}]),"use strict",yeomanApp.factory("ZoneService",["$rootScope","$http","UIEvents","NinjaUtilities","ZoneFactory",function(a,b,c,d,e){var f={Zones:[],GetZones:function(a){b.get("/zone").success(function(b){DEBUG&&console.log("GetZones:",b);var c=d.ObjectArrayToArray(b);this.Zones=this.InstantiateZones(c),a&&a(b)}.bind(this)).error(function(b){DEBUG&&console.log("GetZones (FAILED):",b),a&&a(b)}.bind(this))},InstantiateZones:function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c],e=this.InstantiateZone(d);b.push(e)}return b},InstantiateZone:function(a){var b=new e(a);return b},GetZone:function(a,c){b.get("/zone/"+a).success(function(a){DEBUG&&console.log("GetZone:",a),c&&c(a)})},SaveZone:function(a,c){a.id?b.put("/zone/"+a.id,a.Options,{headers:{"Content-Type":"application/json",Accept:"application/json"}}).success(function(a){DEBUG&&console.log("SaveZone Existing:",a),c&&c(a)}):b.post("/zone",a.Options,{headers:{"Content-Type":"application/json",Accept:"application/json"}}).success(function(a){DEBUG&&console.log("SaveZone New:",a),c&&c(a)})},DeleteZone:function(a,c){a.id&&b.delete("/zone/"+a.id).success(function(b){DEBUG&&console.log("DeleteZone:",b,a)})}};return a.$on(c.ZoneRemoved,function(a,b){DEBUG&&console.log("ZoneRemoved watch",b);var c=f.Zones.indexOf(b);f.Zones.splice(c,1)}),a.$on(c.ZoneAdded,function(a,b){DEBUG&&console.log("ZoneAdded watch",b),f.Zones.push(b)}),f}]),"use strict",yeomanApp.factory("EditZoneService",["ZoneFactory",function(a){var b={Zone:null,Reset:function(){this.Zone=new a}};return b.Reset(),b}]),"use strict",yeomanApp.controller("ConfigureTriggerCtrl",["$scope","$rootScope","UIEvents","EditTriggerService","EditZoneService",function(a,b,c,d,e){a.Zone=e.Zone,a.Trigger=d.Trigger,a.Save=function(){a.configureTrigger.$valid&&a.Trigger.Save(function(){a.setRoute("/editZone")})},a.Delete=function(){a.Trigger.Delete(function(){a.setRoute("/editZone")})},a.IsListening=!1,a.ListenEntries=[],a.Listen=function(b){a.IsListening=!0},a.Stop=function(){a.IsListening=!1,a.ListenEntries=[]},a.Clear=function(){a.Trigger.Options.data=null},b.$on(c.PusherData,function(b,c){a.$apply(function(){if(a.IsListening&&parseInt(c.D,10)===11){var b=a.FindEntry(c.DA);if(b){var d=a.ListenEntries.indexOf(b);a.ListenEntries[d].Count++;var e=a.GetDetectedValueFromEntries();e&&(a.Trigger.Options.data=e.DA,a.Stop()),console.log(a.ListenEntries)}else{var f={DA:c.DA,Count:1};a.ListenEntries.push(f)}}})}),a.FindEntry=function(b){for(var c=0;c<a.ListenEntries.length;c++){var d=a.ListenEntries[c];if(d.DA===b)return d}},a.RemoveEntry=function(b){var c=a.ListenEntries.indexOf(b);a.ListenEntries.splice(c,1)},a.RemoveEntryByDataString=function(b){for(var c=0;c<a.ListenEntries.length;c++){var d=a.ListenEntries[c];if(d.DA===b){a.RemoveEntry(d);break}}},a.GetDetectedValueFromEntries=function(){for(var b=0;b<a.ListenEntries.length;b++){var c=a.ListenEntries[b];if(c.Count>=3)return c}}}]),"use strict",yeomanApp.factory("EditTriggerService",["TriggerFactory",function(a){var b={Trigger:null,Reset:function(){this.Trigger=new a}};return b.Reset(),b}]),"use strict",yeomanApp.filter("rfHex",["$filter",function(a){return function(a){if(a){var b=parseInt(a,2);return b.toString(16)}return""}}]),"use strict",yeomanApp.filter("propercase",function(){return function(a){var b=a.split(" "),c=new Array;for(var d in b){var e=b[d].charAt(0).toUpperCase()+b[d].substr(1).toLowerCase();c.push(e)}var f=c.join(" ").trim();return f}}),"use strict",yeomanApp.controller("UtilitybarCtrl",["$scope","$http","UIEvents",function(a,b,c){a.Override=!1,a.SetOverride=function(c){var d={override:c===null?"null":c.toString()};b.put("/override",d).success(function(b){a.Override=c}).error(function(a){})},a.GetOverride=function(){b.get("/override").success(function(b){a.$broadcast(c.OverrideUpdate,b.override),a.Override=b.override}).error(function(a){})},a.GetOverride(),a.$on(c.OverrideUpdate,function(b,c){a.Override=c})}]),"use strict",yeomanApp.controller("AlertsCtrl",["$scope","AlertService","AlertFactory","EditAlertService",function(a,b,c,d){a.Alerts=b.Alerts,a.AddAlert=function(){var b=new c;d.Alert=b,a.setRoute("/configureAlert")},a.EditAlert=function(b){d.Alert=b,a.setRoute("/configureAlert")},a.Delete=function(a){console.log("Deleting Alert",a),a.Delete()},a.Activate=function(a){a.Activate()},a.Deactivate=function(a){a.Deactivate()}}]),"use strict",yeomanApp.factory("AlertService",["$rootScope","$http","UIEvents","NinjaUtilities","AlertFactory",function(a,b,c,d,e){var f={Alerts:[],GetAlerts:function(a){b.get("/alert").success(function(b){DEBUG&&console.log("GetAlerts:",b);var c=d.ObjectArrayToArray(b);this.Alerts=this.InstantiateAlerts(c),a&&a(b)}.bind(this)).error(function(b){DEBUG&&console.log("GetAlerts (FAILED)",b),a&&a(b)}.bind(this))},InstantiateAlerts:function(a){var b=[];for(var c=0;c<a.length;c++){var d=a[c],e=this.InstantiateAlert(d);b.push(e)}return b},InstantiateAlert:function(a){var b=new e(a);return b}};return a.$on(c.AlertRemoved,function(a,b){DEBUG&&console.log("AlertRemoved watch",b);var c=f.Alerts.indexOf(b);f.Alerts.splice(c,1)}),a.$on(c.AlertAdded,function(a,b){DEBUG&&console.log("AlertAdded watch",b),f.Alerts.push(b)}),f}]),"use strict",yeomanApp.factory("EditAlertService",["AlertFactory",function(a){var b={Alert:null,Reset:function(){this.Alert=new a}};return b.Reset(),b}]),"use strict",yeomanApp.controller("ConfigureAlertCtrl",["$scope","EditAlertService",function(a,b){a.Alert=b.Alert,a.Save=function(){a.configureAlert.$valid&&a.Alert.Save(function(){a.setRoute("/alerts")})}}]),"use strict",yeomanApp.directive("foundationHeader",["UIEvents",function(a){var b="expanded";return{restrict:"A",link:function(d,e,f){d.$on(a.TopBarOpen,function(a){e.addClass(b)}),d.$on(a.TopBarClose,function(a){e.removeClass(b),e.removeAttr("style"),e.foundationTopBar("reset")})}}}]),"use strict",yeomanApp.controller("HistoryCtrl",["$scope","$http",function(a,b){a.History=[],b.get("/history").success(function(b){a.History=b,console.log(b)})}]),"use strict",yeomanApp.controller("TriggerCtrl",["$scope","$rootScope","UIEvents",function(a,b,c){}]),"use strict",yeomanApp.directive("triggerListen",["$rootScope","UIEvents",function(a,b){var c="hsl(195,46%,70%)";c="hsl(48,83%,76%)";var d=6e3;return{restrict:"A",link:function(f,g,h){a.$on(b.PusherData,function(a,b){if(f.trigger.Options.data===b.DA){g.stop(!0,!0).effect("highlight",{color:c},d);var e=new moment(b.timestamp);g.find(".lastActuated").html(e.format("YYYY-MM-DD h:mm:ssa"))}})}}}]);